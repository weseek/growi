# Jotai ç§»è¡Œé€²æ—ï¼ˆ2025-09-05 æ›´æ–°ï¼‰

## ç§»è¡Œä½œæ¥­ãƒ•ãƒ­ãƒ¼ âš ï¸ã€é‡è¦ã€‘

### åŸºæœ¬æ‰‹é †ï¼ˆå¿…ãšé †åºé€šã‚Šã«å®Ÿè¡Œï¼‰
1. **æ–°ã—ã„Jotaiãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã‚’ä½œæˆ**
2. **ä½¿ç”¨ç®‡æ‰€ã‚’æ–°ã—ã„å®Ÿè£…ã«ç½®ãæ›ãˆ**
3. **ã€å¿…é ˆã€‘æ—§ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤** â† ã“ã‚Œã‚’å¿˜ã‚Œãšã«ï¼
4. **ã€å¿…é ˆã€‘å‹ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ** â† migrationå®Œäº†ç¢ºèª

```bash
# å‹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œï¼ˆmigrationå®Œäº†ç¢ºèªï¼‰
cd /workspace/growi/apps/app && pnpm run lint:typecheck
```

### âš ï¸ æ—§ã‚³ãƒ¼ãƒ‰å‰Šé™¤ãŒå¿…é ˆãªç†ç”±
- **Migrationå®Œäº†ã®ç¢ºèª**: æ—§ã‚³ãƒ¼ãƒ‰ãŒæ®‹ã£ã¦ã„ã‚‹ã¨ã€ç§»è¡ŒãŒä¸å®Œå…¨ã§ã‚‚typecheckãŒãƒ‘ã‚¹ã—ã¦ã—ã¾ã†
- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹æ¤œè¨¼**: æ—§ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€ç§»è¡Œæ¼ã‚ŒãŒç¢ºå®Ÿã«æ¤œå‡ºã•ã‚Œã‚‹
- **ä¿å®ˆæ€§ã®å‘ä¸Š**: é‡è¤‡ã‚³ãƒ¼ãƒ‰ãŒãªã„ã“ã¨ã§ã€å°†æ¥ã®å¤‰æ›´æ™‚ã®æ··ä¹±ã‚’é˜²ã

## å®Ÿè£…çŠ¶æ³

### âœ… ç§»è¡Œå®Œäº†æ¸ˆã¿

#### ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ»ãƒ‡ãƒã‚¤ã‚¹ãƒ»ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼çŠ¶æ…‹ï¼ˆå®Œäº†ï¼‰
- âœ… `useDrawerOpened`: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ‰ãƒ­ãƒ¯ãƒ¼è¡¨ç¤ºçŠ¶æ…‹
- âœ… `usePreferCollapsedMode`: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®æŠ˜ã‚ŠãŸãŸã¿ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ°¸ç¶šåŒ–å¯¾å¿œï¼‰
- âœ… `useSidebarMode`: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ç®¡ç†
- âœ… `useCurrentSidebarContents`: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ï¼ˆæ°¸ç¶šåŒ–å¯¾å¿œï¼‰
- âœ… `useCollapsedContentsOpened`: æŠ˜ã‚ŠãŸãŸã¾ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é–‹é–‰çŠ¶æ…‹
- âœ… `useCurrentProductNavWidth`: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®å¹…ï¼ˆæ°¸ç¶šåŒ–å¯¾å¿œï¼‰
- âœ… `useDeviceLargerThanXl`: ãƒ‡ãƒã‚¤ã‚¹ã‚µã‚¤ã‚ºåˆ¤å®š
- âœ… `useEditorMode`: ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ç®¡ç†

#### ãƒšãƒ¼ã‚¸é–¢é€£çŠ¶æ…‹ï¼ˆå®Œäº†ï¼‰
- âœ… `useCurrentPageId`: ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ID
- âœ… `useCurrentPageData`: ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿
- âœ… `useCurrentPagePath`: ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãƒ‘ã‚¹
- âœ… `usePageNotFound`: ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„çŠ¶æ…‹
- âœ… `usePageNotCreatable`: ãƒšãƒ¼ã‚¸ä½œæˆä¸å¯çŠ¶æ…‹
- âœ… `useLatestRevision`: æœ€æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³
- âœ… ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒ“ã‚¸ãƒ§ãƒ³é–¢é€£ãƒ•ãƒƒã‚¯ç¾¤
- âœ… `useShareLinkId`, `useTemplateTags`, `useTemplateBody`

#### ã‚µãƒ¼ãƒãƒ¼è¨­å®šãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼ˆå®Œäº†ï¼‰
- âœ… ã‚µãƒ¼ãƒãƒ¼è¨­å®šé–¢é€£ã®å…¨atomsã¨hooks
- âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼ˆç¾åœ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã©ï¼‰
- âœ… Socket.IOçŠ¶æ…‹ç®¡ç†

#### SSRãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼ˆå®Œäº†ï¼‰
- âœ… `useHydrateSidebarAtoms`: ã‚µã‚¤ãƒ‰ãƒãƒ¼ç”¨
- âœ… `useHydratePageAtoms`: ãƒšãƒ¼ã‚¸ç”¨
- âœ… `useHydrateGlobalAtoms`: ã‚°ãƒ­ãƒ¼ãƒãƒ«ç”¨

#### æ–°è¦ç§»è¡Œå®Œäº†ï¼ˆ2025-09-05ï¼‰
- âœ… **`usePageControlsX`**: ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®Xåº§æ¨™çŠ¶æ…‹ï¼ˆstates/ui/page.tsï¼‰
  - å®Ÿè£…å ´æ‰€: `states/ui/page.ts`
  - èª­ã¿å–ã‚Šå°‚ç”¨hook: `usePageControlsX()`
  - æ›¸ãè¾¼ã¿å°‚ç”¨hook: `useSetPageControlsX()`
  - ä½¿ç”¨ç®‡æ‰€ã‚’å®Œå…¨ç§»è¡Œï¼ˆPageControlsã€PageHeaderã€PagePathNavStickyï¼‰
- âœ… **`useSelectedGrant`**: ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã§ã®é¸æŠä¸­grantçŠ¶æ…‹ï¼ˆstates/ui/editor/ï¼‰
  - å®Ÿè£…å ´æ‰€: `states/ui/editor/atoms.ts`, `hooks.ts`
  - ä½¿ç”¨ç®‡æ‰€ã‚’å®Œå…¨ç§»è¡Œï¼ˆGrantSelectorã€SavePageControlsã€PageEditorï¼‰
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: `{ grant: PageGrant.GRANT_PUBLIC }`

#### ãƒ¢ãƒ¼ãƒ€ãƒ«çŠ¶æ…‹ï¼ˆå€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«æ–¹å¼ã§ç§»è¡Œä¸­ï¼‰
- âœ… **`usePageCreateModal`**: ãƒšãƒ¼ã‚¸ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆstates/ui/modal/page-create.tsï¼‰
- âœ… **`usePageDeleteModal`**: ãƒšãƒ¼ã‚¸å‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆstates/ui/modal/page-delete.tsï¼‰
- âœ… **å€‹åˆ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹å¼**: `from '~/states/ui/modal/page-create'` ã§ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–

### âœ… å‹ãƒã‚§ãƒƒã‚¯ä¿®æ­£ï¼ˆå®Œäº†æ¸ˆã¿ï¼‰
- âœ… å…¨ã¦ã®TS2488ã‚¨ãƒ©ãƒ¼ï¼ˆé…åˆ—åˆ†å‰²ä»£å…¥ã®èª¤ç”¨ï¼‰ã‚’ä¿®æ­£æ¸ˆã¿
- âœ… `pnpm run lint:typecheck` ãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèªæ¸ˆã¿
- âœ… ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ï¼š
  - `ShareLinkForm.tsx`: `const currentPageId = useCurrentPageId()`
  - `ShareLink.tsx`: `const currentPageId = useCurrentPageId()`
  - `LinkEditModal.tsx`: `const currentPath = useCurrentPagePath()`

### âœ… å“è³ªç¢ºèªï¼ˆ2025-09-05ï¼‰
- âœ… TypeScriptå‹ãƒã‚§ãƒƒã‚¯é€šé
- âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰æˆåŠŸ
- âœ… Socket.IOå‹æ³¨é‡ˆã®ä¿®æ­£å¯¾å¿œæ¸ˆã¿

**å®Ÿè£…æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«:**
- `states/ui/sidebar/`: ã‚µã‚¤ãƒ‰ãƒãƒ¼çŠ¶æ…‹ã®å®Œå…¨å®Ÿè£…
- `states/ui/device.ts`: ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹
- `states/ui/editor/`: ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼çŠ¶æ…‹ï¼ˆuseSelectedGrantè¿½åŠ ï¼‰
- `states/ui/page.ts`: ãƒšãƒ¼ã‚¸UIçŠ¶æ…‹ï¼ˆusePageControlsXæ–°è¦è¿½åŠ ï¼‰
- `states/ui/modal/`: å€‹åˆ¥ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆpage-create, page-deleteï¼‰
- `states/page/`: ãƒšãƒ¼ã‚¸é–¢é€£çŠ¶æ…‹ã®å®Œå…¨å®Ÿè£…
- `states/server-configurations/`: ã‚µãƒ¼ãƒãƒ¼è¨­å®šçŠ¶æ…‹
- `states/global/`: ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹
- `states/socket-io/`: Socket.IOçŠ¶æ…‹

## ğŸš§ æ¬¡ã®å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆå„ªå…ˆåº¦é †ï¼‰

### **å„ªå…ˆåº¦ 1: æ®‹ã‚Šãƒ¢ãƒ¼ãƒ€ãƒ«çŠ¶æ…‹ã®ç§»è¡Œ**

#### å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«æ–¹å¼ã§ã®ç¶™ç¶šå®Ÿè£… â† **æ¬¡ã®ä¸»è¦ã‚¿ã‚¹ã‚¯**
- **æ®‹ã‚Š16å€‹ã®ãƒ¢ãƒ¼ãƒ€ãƒ«**: å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ« `states/ui/modal/[modal-name].ts` ã§å®Ÿè£…
- **å¯¾è±¡ãƒ¢ãƒ¼ãƒ€ãƒ«**:
  - `useGrantedGroupsInheritanceSelectModal`, `useEmptyTrashModal`
  - `usePageDuplicateModal`, `usePageRenameModal`, `usePutBackPageModal`
  - `usePagePresentationModal`, `usePrivateLegacyPagesMigrationModal`
  - `useDescendantsPageListModal`, `usePageAccessoriesModal`
  - `useUpdateUserGroupConfirmModal`, `useShortcutsModal`
  - `useDrawioModal`, `useHandsontableModal`, `useConflictDiffModal`
  - `useBookmarkFolderDeleteModal`, `useDeleteAttachmentModal`
  - `usePageSelectModal`, `useTagEditModal`
- **å®Ÿè£…æ–¹é‡**: æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆpage-create, page-deleteï¼‰ã‚’è¸è¥²
- **ç‰¹å¾´**: ã™ã¹ã¦ä¸€æ™‚çš„ãªçŠ¶æ…‹ã§æ°¸ç¶šåŒ–ä¸è¦

### **å„ªå…ˆåº¦ 2: ä»–ã®UIé–¢é€£ãƒ•ãƒƒã‚¯ï¼ˆåˆ¤å®šãƒ»æ¤œè¨ãŒå¿…è¦ï¼‰**

ä»¥ä¸‹ã®ãƒ•ãƒƒã‚¯ã¯SWRç¶™ç¶šä½¿ç”¨ã‚’æ¤œè¨ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã‚„computedå€¤ã®ãŸã‚ï¼‰ï¼š
- `useCurrentPageTocNode`: ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ç›®æ¬¡ãƒ‡ãƒ¼ã‚¿
- `useSidebarScrollerRef`: refç®¡ç†
- `useIsMobile`, `useIsDeviceLargerThanMd/Lg`: ãƒ‡ãƒã‚¤ã‚¹åˆ¤å®šï¼ˆä¸€éƒ¨ã¯æ—¢ã«ç§»è¡Œæ¸ˆã¿ï¼‰
- `usePageTreeDescCountMap`: è¤‡é›‘ãªMapæ“ä½œ
- `useCommentEditorDirtyMap`: è¤‡é›‘ãªMapæ“ä½œ
- `useIsAbleToShow*`: computed booleanå€¤ç¾¤

### **æœ€çµ‚ãƒ•ã‚§ãƒ¼ã‚º: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**

#### ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ã¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ—§ã‚³ãƒ¼ãƒ‰å‰Šé™¤æ‰‹é †ã®å³å®ˆï¼‰
- `stores/ui.tsx` ã®æ®µéšçš„ç¸®å°ãƒ»æœ€çµ‚å‰Šé™¤
- `stores/modal.tsx` ã®å®Œå…¨å‰Šé™¤
- æ®‹å­˜ã™ã‚‹ SWR ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ã®æœ€çµ‚åˆ¤å®š
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°

## ğŸ“Š é€²æ—ã‚µãƒãƒªãƒ¼

- **å®Œäº†**: ä¸»è¦ãªUIçŠ¶æ…‹ + ãƒšãƒ¼ã‚¸é–¢é€£çŠ¶æ…‹ + SSRãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + å‹ãƒã‚§ãƒƒã‚¯ä¿®æ­£ + æ–°è¦2çŠ¶æ…‹ + ãƒ¢ãƒ¼ãƒ€ãƒ«2å€‹
- **æ¬¡ã®ã‚¿ã‚¹ã‚¯**: æ®‹ã‚Š16å€‹ã®ãƒ¢ãƒ¼ãƒ€ãƒ«çŠ¶æ…‹ã®å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè£…
- **æ®‹ã‚Š**: UIé–¢é€£ãƒ•ãƒƒã‚¯æ•°å€‹ï¼ˆåˆ¤å®šå¿…è¦ï¼‰ + ãƒ¢ãƒ¼ãƒ€ãƒ«16å€‹ + ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **æ¨å®šæ®‹å·¥æ•°**: 1-2é€±é–“

## ğŸ”„ æ›´æ–°å±¥æ­´

- **2025-09-05**: å€‹åˆ¥ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«æ–¹å¼æ¡ç”¨ã€é‡è¦ãªç§»è¡Œæ‰‹é †è¿½åŠ ã€ãƒ¡ãƒ¢ãƒªãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆ
- **2025-09-05**: `usePageControlsX`ã¨`useSelectedGrant`ã®ç§»è¡Œå®Œäº†ã€ãƒ“ãƒ«ãƒ‰ç¢ºèªæ¸ˆã¿
- **2025-09-05**: å‹ãƒã‚§ãƒƒã‚¯ä¿®æ­£å®Œäº†ã€ãƒšãƒ¼ã‚¸é–¢é€£çŠ¶æ…‹ç§»è¡Œæ¸ˆã¿ã‚’ç¢ºèªã€é€²æ—çŠ¶æ³ã‚’å®Ÿæ…‹ã«åˆã‚ã›ã¦æ›´æ–°
- **2025-07-30**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆçµ±åˆã€é€²æ—ã®å®Ÿè£…çŠ¶æ³åæ˜ 
- **2025-07-XX**: ã‚µã‚¤ãƒ‰ãƒãƒ¼é–¢é€£ã®ç§»è¡Œå®Œäº†
- **2025-07-XX**: SSRãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œå®Œäº†