# Phase 2A å®Ÿè£…ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ - è©³ç´°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: GROWI ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ”¹ä¿®  
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2Aå®Œé‚  
**ä½œæˆæ—¥**: 2025-06-17  
**è¦‹ç©å·¥æ•°**: 8-12æ™‚é–“

## ğŸ“‹ **ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

### **ğŸ”´ Task 1: ã‚¹ã‚­ãƒ¼ãƒå¼·åŒ–** `[1æ™‚é–“]` `[ ]å®Œäº†`

#### 1.1 LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ›´æ–° `[ ]`
- [ ] `llm-response-schemas.ts`ã®`startLine`ã‚’å¿…é ˆã«å¤‰æ›´
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°
- [ ] TypeScriptå‹å®šç¾©æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/interfaces/editor-assistant/llm-response-schemas.ts`

```typescript
// å¤‰æ›´å‰: startLine ãŒ optional
startLine: z.number().int().positive().optional()

// å¤‰æ›´å¾Œ: startLine ãŒ required
startLine: z.number().int().positive().describe('Starting line number for search (1-based, REQUIRED)')
```

#### 1.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–° `[ ]`
- [ ] `edit/index.ts`ã®instructioné–¢æ•°æ›´æ–°
- [ ] `startLine`å¿…é ˆåŒ–ã®æ˜è¨˜
- [ ] ä¾‹ç¤ºã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/server/routes/edit/index.ts`

### **ğŸ”´ Task 2: search-replaceå‡¦ç†å®Ÿè£…** `[4-5æ™‚é–“]` `[ ]å®Œäº†`

#### 2.1 search-replace-engine.tsä½œæˆ `[ ]`
- [ ] æ–°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] `performSearchReplace`é–¢æ•°å®Ÿè£…
- [ ] YTextçµ±åˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/editor-assistant/search-replace-engine.ts`

#### 2.2 useEditorAssistantæ›´æ–° `[ ]`
- [ ] useEffectå†…ã®diffå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´
- [ ] æ—¢å­˜ã®`appendTextLastLine`ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«å¤‰æ›´
- [ ] search-replace-engineçµ±åˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/editor-assistant/use-editor-assistant.tsx`

```typescript
// å¤‰æ›´å¯¾è±¡: useEffectå†…ã®pendingDetectedDiff.forEachå‡¦ç†
// ç¾åœ¨: replaceã®ã¿ä½¿ç”¨
// å¤‰æ›´å¾Œ: searchã¨replaceã®ä¸¡æ–¹ä½¿ç”¨ + è¡Œç•ªå·æŒ‡å®š
```

#### 2.3 index.tsã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ›´æ–° `[ ]`
- [ ] æ–°ã—ã„é–¢æ•°ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/editor-assistant/index.ts`

### **ğŸ”´ Task 3: Fuzzy Matchingçµ±åˆ** `[2æ™‚é–“]` `[ ]å®Œäº†`

#### 3.1 fuzzy-matching.tsæ©Ÿèƒ½æ‹¡å¼µ `[ ]`
- [ ] `SearchContext`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ›´æ–°
- [ ] `MatchResult`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ›´æ–°
- [ ] `preferredStartLine`å¯¾å¿œå®Ÿè£…
- [ ] `tryExactLineMatch`ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] `performBufferedSearch`ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/editor-assistant/fuzzy-matching.ts`

#### 3.2 text-normalization.tsç¢ºèª `[ ]`
- [ ] æ—¢å­˜å®Ÿè£…ã®å‹•ä½œç¢ºèª
- [ ] å¿…è¦ã«å¿œã˜ã¦å¾®èª¿æ•´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/editor-assistant/text-normalization.ts`

### **ğŸ”´ Task 4: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–** `[1æ™‚é–“]` `[ ]å®Œäº†`

#### 4.1 error-handling.tsæ›´æ–° `[ ]`
- [ ] `SearchReplaceError`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¿½åŠ 
- [ ] `createSearchError`é–¢æ•°å®Ÿè£…
- [ ] è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®šç¾©

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/editor-assistant/error-handling.ts`

#### 4.2 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å›½éš›åŒ– `[ ]`
- [ ] æ—¥æœ¬èªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### **ğŸ”´ Task 5: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆæ›´æ–°** `[2æ™‚é–“]` `[ ]å®Œäº†`

#### 5.1 client-engine-integration.tsxæ›´æ–° `[ ]`
- [ ] `processDetectedDiffsClient`é–¢æ•°å®Œæˆ
- [ ] `startLine`å¿…é ˆãƒã‚§ãƒƒã‚¯å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/client-engine-integration.tsx`

#### 5.2 processor.tsçµ±åˆç¢ºèª `[ ]`
- [ ] æ—¢å­˜ã®processor.tsã¨ã®æ•´åˆæ€§ç¢ºèª
- [ ] å¿…è¦ã«å¿œã˜ã¦èª¿æ•´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `/apps/app/src/features/openai/client/services/editor-assistant/processor.ts`

### **ğŸ”´ Task 6: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ** `[1-2æ™‚é–“]` `[ ]å®Œäº†`

#### 6.1 æ‰‹å‹•ãƒ†ã‚¹ãƒˆ `[ ]`
- [ ] åŸºæœ¬search-replaceå‹•ä½œç¢ºèª
- [ ] Fuzzy matchingå‹•ä½œç¢ºèª
- [ ] è¤‡æ•°diffå‡¦ç†ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

#### 6.2 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ `[ ]`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: æ­£ç¢ºãªæ¤œç´¢ãƒ»ç½®æ›**
```json
{
  "search": "function calculateTotal(items) {\n  let total = 0;",
  "replace": "function calculateTotal(items) {\n  let total = 0;\n  // Added comment",
  "startLine": 15
}
```
- [ ] å®Ÿè¡Œçµæœ: `[ ]æˆåŠŸ` `[ ]å¤±æ•—`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: Fuzzy matching**
```json
{
  "search": "function calculateTotal(items) {\n let total = 0;",
  "replace": "function calculateSum(items) {\n  let sum = 0;",
  "startLine": 15
}
```
- [ ] å®Ÿè¡Œçµæœ: `[ ]æˆåŠŸ` `[ ]å¤±æ•—`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: è¤‡æ•°diffå‡¦ç†**
- [ ] 5å€‹ä»¥ä¸Šã®diffã®åŒæ™‚å‡¦ç†
- [ ] å®Ÿè¡Œçµæœ: `[ ]æˆåŠŸ` `[ ]å¤±æ•—`

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹4: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
- [ ] å­˜åœ¨ã—ãªã„è¡Œç•ªå·æŒ‡å®š
- [ ] æ¤œç´¢ãƒ†ã‚­ã‚¹ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
- [ ] å®Ÿè¡Œçµæœ: `[ ]é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯` `[ ]ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ`

#### 6.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ `[ ]`
- [ ] 1000è¡Œãƒ•ã‚¡ã‚¤ãƒ«ã§ã®æ¤œç´¢æ™‚é–“: `____ms`
- [ ] 10ç®‡æ‰€åŒæ™‚ç½®æ›æ™‚é–“: `____ms`
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: `____MB`
- [ ] UI blockingæ™‚é–“: `____ms`

### **ğŸ”´ Task 7: å“è³ªç¢ºèª** `[30åˆ†]` `[ ]å®Œäº†`

#### 7.1 ESLint/TypeScriptç¢ºèª `[ ]`
- [ ] `cd /workspace/growi/apps/app && turbo run lint`
- [ ] ã‚¨ãƒ©ãƒ¼0ä»¶ç¢ºèª
- [ ] è­¦å‘Šã®å¯¾å¿œ

#### 7.2 ãƒ“ãƒ«ãƒ‰ç¢ºèª `[ ]`
- [ ] `cd /workspace/growi/apps/app && turbo run build`
- [ ] ãƒ“ãƒ«ãƒ‰æˆåŠŸç¢ºèª

## ğŸ“Š **é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**

### **å®Œäº†çŠ¶æ³**
- Task 1: `[ ]å®Œäº†` `____æ™‚é–“`
- Task 2: `[ ]å®Œäº†` `____æ™‚é–“`  
- Task 3: `[ ]å®Œäº†` `____æ™‚é–“`
- Task 4: `[ ]å®Œäº†` `____æ™‚é–“`
- Task 5: `[ ]å®Œäº†` `____æ™‚é–“`
- Task 6: `[ ]å®Œäº†` `____æ™‚é–“`
- Task 7: `[ ]å®Œäº†` `____æ™‚é–“`

**åˆè¨ˆå·¥æ•°**: `____æ™‚é–“` / 8-12æ™‚é–“è¦‹ç©

### **æˆåŠŸæŒ‡æ¨™é”æˆçŠ¶æ³**
- [ ] è¡Œç•ªå·æŒ‡å®šã§ã®æ­£ç¢ºãªæ¤œç´¢: 95%ä»¥ä¸Šã®æˆåŠŸç‡
- [ ] Fuzzy matching: 80%ä»¥ä¸Šã®é¡ä¼¼åº¦ã§æ¤œç´¢æˆåŠŸ  
- [ ] è¤‡æ•°diffå‡¦ç†: 5å€‹ä»¥ä¸Šã®diffã®åŒæ™‚å‡¦ç†
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: æ¤œç´¢å¤±æ•—æ™‚ã®é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- [ ] æ¤œç´¢æ™‚é–“: 1000è¡Œä»¥ä¸‹ã§100msä»¥å†…
- [ ] ç½®æ›æ™‚é–“: 10ç®‡æ‰€ä»¥ä¸‹ã§500msä»¥å†…
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 10MBä»¥ä¸‹
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶å¿œç­”æ€§: UI blocking 0ç§’

## ğŸ› **å•é¡Œãƒ»èª²é¡Œè¨˜éŒ²**

### **é­é‡ã—ãŸå•é¡Œ**
1. **å•é¡Œ**: `_____________________________`
   - **è§£æ±ºç­–**: `_____________________________`
   - **æ‰€è¦æ™‚é–“**: `____æ™‚é–“`

2. **å•é¡Œ**: `_____________________________`
   - **è§£æ±ºç­–**: `_____________________________`
   - **æ‰€è¦æ™‚é–“**: `____æ™‚é–“`

### **æŠ€è¡“çš„åˆ¤æ–­**
1. **åˆ¤æ–­**: `_____________________________`
   - **ç†ç”±**: `_____________________________`
   - **å½±éŸ¿**: `_____________________________`

## âœ… **Phase 2Aå®Œé‚ç¢ºèª**

### **æœ€çµ‚ãƒã‚§ãƒƒã‚¯é …ç›®**
- [ ] ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†
- [ ] æˆåŠŸæŒ‡æ¨™ã‚’ã™ã¹ã¦é”æˆ
- [ ] ESLintã‚¨ãƒ©ãƒ¼0ä»¶
- [ ] ãƒ“ãƒ«ãƒ‰æˆåŠŸ
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆã™ã¹ã¦æˆåŠŸ

### **å®Œé‚å®£è¨€**
- [ ] **Phase 2Aå®Œé‚**: å®Ÿç”¨çš„ãªsearch-replaceæ©Ÿèƒ½ã®å®Ÿè£…å®Œäº†
- **å®Œé‚æ—¥**: `2025-__-__`
- **å®Ÿç¸¾å·¥æ•°**: `____æ™‚é–“`
- **å“è³ªç¢ºèª**: `âœ…æ¸ˆã¿`

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Phase 2B ã‚µãƒ¼ãƒãƒ¼æœ€é©åŒ– ã¾ãŸã¯ Phase 3 ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰çµ±åˆ
